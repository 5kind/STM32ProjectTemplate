# STM32 Project Template

- This is a project template generated by STM32CubeMX and managed using CMake. (The `Libraries Project` is organized similarly to the `STM32F10x_StdPeriph_Lib` project, making it easy to update/replace.)
- Chip model used: `STM32F103C8T6`
- If you need the `HAL` library, please use the [master branch](https://github.com/5kind/STM32ProjectTemplate)

## Instructions

1. Create a new repository by [Use the template](https://github.com/new?template_name=STM32ProjectTemplate&template_owner=5kind). Do not fork it.
2. [main.c](Core/Src/main.c) contains a simple lighting program, which can replace/add to the files under `Core/{Inc,Src}` and has been included in [CMakeLists.txt](cmake/stm32cubemx/CMakeLists.txt) (`Core/Src/*.{c,cpp} Core/Inc/`).
3. All SPL driver libraries are included by default. [core_cm3.c](Libraries/CMSIS/CM3/CoreSupport/core_cm3.c) has been modified. See [CMakeLists.txt](cmake/stm32cubemx/CMakeLists.txt) or [Modified version of core_cm3.c](Core/Src/core_cm3.c):
```
# STM32 SPL Drivers
file(GLOB STM32_Drivers_Src
# Incompatible with newer versions of GCC,
# see Core/Src/core_cm3.c for replacement.
# ${StdPeriphLibraries}/CMSIS/CM3/CoreSupport/core_cm3.c
${StdPeriphLibraries}/CMSIS/CM3/DeviceSupport/ST/STM32F10x/system_stm32f10x.c 
${StdPeriphLibraries}/STM32F10x_StdPeriph_Driver/src/*.c
)
```
```diff Libraries/CMSIS/CM3/CoreSupport/core_cm3.c Core/Src/core_cm3.c
736c736
< __ASM volatile ("strexb %0, %2, [%1]" : "=r" (result) : "r" (addr), "r" (value) );
---
> __ASM volatile ("strexb %0, %2, [%1]" : "=&r" (result) : "r" (addr), "r" (value) );
753c753
< __ASM volatile ("strexh %0, %2, [%1]" : "=r" (result) : "r" (addr), "r" (value) );
---
> __ASM volatile ("strexh %0, %2, [%1]" : "=&r" (result) : "r" (addr), "r" (value) );
```


## Compilation method

```
# It is recommended to use ninja
#Debug:
cmake -DCMAKE_TOOLCHAIN_FILE=cmake/gcc-arm-none-eabi.cmake -S ./ -B build/Debug -G"Ninja" -DCMAKE_BUILD_TYPE=Debug && ninja -C build/Debug
# Release:
cmake -DCMAKE_TOOLCHAIN_FILE=cmake/gcc-arm-none-eabi.cmake -S ./ -B build/Release -G"Ninja" -DCMAKE_BUILD_TYPE=Release && ninja -C build/Release
```

# License or User Agreement
See
```
# BSD-3-Clause
Libraries/CMSIS/CM3/DeviceSupport/ST/STM32F10x/LICENSE.txt
# ST: SLA0044
Libraries/STM32F10x_StdPeriph_Driver/LICENSE.txt
Project/STM32F10x_StdPeriph_Template/LICENSE.txt
# ARM: LEC-PRE-00425-V2.0
Libraries/CMSIS/License.doc
```